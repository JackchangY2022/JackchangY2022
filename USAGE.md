# 工作流设计器使用指南

## 🚀 快速开始

### 1. 启动应用
访问 http://localhost:3000 打开工作流设计器

### 2. 加载演示工作流
- 点击工具栏中的"演示"按钮
- 系统会自动加载一个基于原始flow1.txt的演示工作流
- 这个工作流展示了门诊登记的完整流程

### 3. 界面概览
- **左侧侧边栏**: 节点模板、变量管理、表达式管理、工作流信息
- **中央画布**: 工作流设计区域，支持拖拽和连接
- **顶部工具栏**: 文件操作、编辑操作、视图控制等
- **右侧属性面板**: 选中节点或连接的详细配置

## 📝 基本操作

### 创建新工作流
1. 如果没有工作流，点击中央的"创建新工作流"按钮
2. 输入工作流名称
3. 系统会自动创建包含开始和结束节点的基础工作流

### 添加节点
1. 从左侧侧边栏选择需要的节点类型
2. 拖拽到画布上的目标位置
3. 节点会自动添加到工作流中

### 连接节点
1. 将鼠标悬停在源节点上，会显示连接点
2. 从源节点的输出连接点拖拽到目标节点的输入连接点
3. 释放鼠标完成连接

### 配置节点
1. 点击选中节点
2. 右侧属性面板会显示该节点的配置选项
3. 修改配置后点击"保存更改"

## 🔧 节点类型详解

### 开始节点 (START)
- 工作流的入口点
- 每个工作流只能有一个开始节点
- 绿色圆形图标，不需要配置参数

### 结束节点 (END)
- 工作流的出口点
- 可以有多个结束节点
- 红色方形图标，可配置返回值

### 条件判断 (CONDITION)
- 基于表达式进行分支判断
- 黄色分叉图标
- 配置项：
  - **条件表达式**: 判断条件的表达式
  - **真分支节点ID**: 条件为真时的下一个节点
  - **假分支节点ID**: 条件为假时的下一个节点

### 变量赋值 (VARVALUE)
- 为工作流变量赋值
- 蓝色变量图标
- 配置项：
  - **赋值列表**: 可添加多个变量赋值操作
  - 每个赋值包含：变量选择、值或表达式

### 类型转换 (DATATYPECONVERT)
- 转换数据类型
- 紫色循环箭头图标
- 配置项：
  - **源变量ID**: 要转换的变量
  - **目标变量ID**: 转换后存储的变量
  - **源类型**: 原始数据类型
  - **目标类型**: 转换后的数据类型

### HTTP请求 (HTTP_REQUEST)
- 发送HTTP请求到外部服务
- 绿色地球图标
- 配置项：
  - **请求URL**: 目标服务地址
  - **请求方法**: GET、POST、PUT、DELETE等
  - **请求头**: JSON格式的请求头配置
  - **请求体**: 请求内容

### 数据库操作 (DATABASE)
- 执行数据库查询
- 灰色数据库图标
- 配置项：
  - **连接ID**: 数据库连接标识
  - **SQL查询**: 要执行的SQL语句
  - **参数**: JSON数组格式的查询参数

### 调用流程 (CALLFLOW)
- 调用其他工作流
- 粉色电话图标
- 配置项：
  - **流程ID**: 要调用的工作流ID
  - **流程名称**: 工作流名称
  - **变量映射**: 变量映射关系

### 异常处理 (ERROR)
- 处理异常情况
- 红色警告图标
- 用于捕获和处理工作流执行中的错误

### JSON转换 (JSONTOJSON)
- JSON数据格式转换
- 青色双向箭头图标
- 用于转换JSON数据结构

## 📊 变量管理

### 添加变量
1. 在左侧侧边栏的变量区域点击"+"按钮
2. 输入变量名称
3. 系统会创建一个字符串类型的变量

### 变量类型
- **字符串 (STRING)**: 文本数据
- **数字 (NUMBER)**: 数值数据
- **布尔 (BOOLEAN)**: 真假值
- **JSON (JSON)**: JSON对象
- **数组 (ARRAY)**: 数组数据
- **日期 (DATE)**: 日期时间

### 使用变量
- 在节点配置中选择变量
- 变量会在下拉列表中显示
- 可以在表达式中引用变量

## ⚡ 表达式管理

### 添加表达式
1. 在左侧侧边栏的表达式区域点击"+"按钮
2. 输入表达式名称和内容
3. 表达式可以在节点配置中使用

### 表达式语法
- 支持JavaScript语法
- 可以引用工作流变量
- 示例：`return P_J_Input != null ? true : false;`

## 💾 文件操作

### 保存工作流
- 点击工具栏"保存"按钮
- 工作流会以JSON格式下载到本地

### 加载工作流
- 点击工具栏"打开"按钮
- 选择JSON格式的工作流文件
- 支持新格式和原始格式的自动识别

### 导出工作流
- 点击工具栏"导出"按钮
- 生成包含版本信息的导出文件

### 导入工作流
- 点击工具栏"导入"按钮
- 支持多种格式：
  - 新格式的工作流文件
  - 原始格式的工作流文件（如flow1.txt）
  - 导出格式的工作流文件

## 🔍 工作流验证

### 自动验证
系统会自动检查工作流的完整性：
- 是否包含开始节点
- 节点连接是否完整
- 变量引用是否正确
- 表达式语法是否正确

### 验证结果
- **错误**: 必须修复才能正常运行
- **警告**: 建议修复，不影响基本运行

### 常见验证问题
1. **缺少开始节点**: 每个工作流必须有一个开始节点
2. **节点未连接**: 检查节点是否有输入或输出连接
3. **变量未定义**: 确保引用的变量已经创建
4. **URL格式错误**: HTTP请求节点的URL格式不正确

## 🎯 最佳实践

### 工作流设计
1. **清晰的命名**: 给节点和变量起有意义的名字
2. **合理的布局**: 保持工作流的视觉清晰度
3. **适当的分组**: 使用颜色区分不同类型的节点
4. **错误处理**: 为关键节点添加错误处理分支

### 性能优化
1. **避免循环依赖**: 检查工作流是否存在死循环
2. **合理的并行度**: 设置适当的最大并行数
3. **超时设置**: 为长时间运行的操作设置合理的超时时间

### 调试技巧
1. **使用演示数据**: 先用演示工作流熟悉功能
2. **逐步构建**: 从简单的工作流开始，逐步增加复杂度
3. **验证检查**: 经常使用验证功能检查工作流完整性

## 🔧 高级功能

### 格式转换
系统支持原始工作流格式的自动转换：
- 自动识别原始格式（ProcessDic结构）
- 转换节点类型和连接关系
- 保留变量和表达式定义
- 生成现代化的可视化界面

### 快捷键
- **Ctrl+S**: 保存工作流
- **Ctrl+O**: 打开工作流
- **Ctrl+Z**: 撤销操作（开发中）
- **Ctrl+Y**: 重做操作（开发中）
- **Delete**: 删除选中的节点或连接
- **Ctrl+0**: 适应视图
- **Ctrl++**: 放大
- **Ctrl+-**: 缩小

### 视图控制
- **缩放**: 使用鼠标滚轮或工具栏按钮
- **平移**: 拖拽画布空白区域
- **适应视图**: 自动调整缩放以显示所有节点
- **小地图**: 显示工作流的缩略图导航

## ❓ 常见问题

### Q: 如何导入原始的flow1.txt文件？
A: 直接点击"导入"按钮选择文件，系统会自动识别格式并转换。

### Q: 节点无法连接怎么办？
A: 检查节点类型，确保从输出连接点拖拽到输入连接点。

### Q: 如何删除节点？
A: 点击选中节点，然后按Delete键或点击工具栏的删除按钮。

### Q: 工作流验证失败怎么办？
A: 查看验证结果中的错误和警告信息，逐一修复问题。

### Q: 如何自定义节点颜色？
A: 选中节点后，在右侧属性面板中修改颜色设置。

## 📞 技术支持

如需技术支持或反馈问题，请：
1. 查看控制台错误信息
2. 截图描述具体问题
3. 提供复现步骤
4. 联系开发团队

---

**祝您使用愉快！** 🎉